C51 COMPILER V9.01   TIME_COUNTER                                                          12/20/2002 22:02:45 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE TIME_COUNTER
OBJECT MODULE PLACED IN time_counter.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE time_counter.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <stdio.h>
   2          #include <reg51.h>
   3          #include <string.h>
   4          extern void delay(int i);
   5          extern void delay_second();
   6          extern void digital_display(int time);
   7          extern void display_string(unsigned char y, unsigned char x, unsigned char string[]);
   8          extern void lcd_init();
   9          extern void lcd_start();
  10          
  11          extern unsigned char code  str_reset[];
  12          char str_prompt[20];
  13          char str_progress[20];
  14          const int WIDTH=20;
  15          const char PROGRESS_MARK[]={"*"};
  16          
  17          sbit pause_btn = P2 ^ 2;       //key3
  18          
  19          
  20          
  21          void display_pause(int time,int order,int current){
  22   1                              char str_status[20];
  23   1                              int remain;
  24   1                              if(order==1){
  25   2                                      remain = time-current;
  26   2                              }else{
  27   2                                      remain = current;
  28   2                              }
  29   1                              sprintf(str_status,"Now:%ds,Remain:%ds",current,remain);
  30   1                       lcd_start();
  31   1                       display_string(1,0,str_prompt);
  32   1                       display_string(2,0,str_status);        
  33   1                       display_string(3,0,str_reset); 
  34   1      }
  35          
  36          
  37          
  38          void display_instruction(){
  39   1              lcd_start();
  40   1              display_string(1,0,str_prompt);         
  41   1              display_string(2,0,str_reset);
  42   1      }
  43          
  44          void clear_progress(){
  45   1              strcpy(str_progress," ");
  46   1      }
  47          
  48          void set_progress(int time,int current){
  49   1              int current_progress = WIDTH*current/time;
  50   1              int i;
  51   1              clear_progress();
  52   1              for(i=0;i<current_progress;i++){
  53   2                      strcat(str_progress,PROGRESS_MARK);
  54   2              }
  55   1      
C51 COMPILER V9.01   TIME_COUNTER                                                          12/20/2002 22:02:45 PAGE 2   

  56   1      }
  57          
  58          
  59          
  60          /**
  61           * @brief 计时    
  62           * 
  63           * @param time 计时时间（十进制）
  64           * @param order 顺序。1:正计时，-1:倒计时
  65           */
  66          void count_time(int time, int order)
  67          {
  68   1          int i;
  69   1          int curr_time; // 显示的时间
  70   1      
  71   1              if (order == 1)
  72   1          {
  73   2              curr_time = 0; //正计时
  74   2                      sprintf(str_prompt,"Forward:%ds",time);
  75   2          }
  76   1          else
  77   1          {
  78   2              curr_time = time; //倒计时
  79   2                      sprintf(str_prompt,"Backward:%ds",time);
  80   2          }
  81   1      
  82   1              display_instruction();
  83   1      
  84   1      
  85   1      
  86   1          delay(200);
  87   1          digital_display(curr_time); //显示初始值
  88   1      
  89   1          for (i = 0; i <= time; i++)
  90   1          {
  91   2              delay_second();             //等待1s
  92   2              digital_display(curr_time + i * order); //更新数码管显示
  93   2      
  94   2                      display_string(3,0,str_progress);
  95   2      
  96   2                      if(pause_btn==1){
  97   3                                       display_pause(time,order,curr_time + i * order);
  98   3                                       while(pause_btn==1); //pause
  99   3                                       display_instruction();
 100   3                      }
 101   2      
 102   2                      
 103   2          }
 104   1              clear_progress();
 105   1              delay(200);
 106   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    421    ----
   CONSTANT SIZE    =     46    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     44      34
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.01   TIME_COUNTER                                                          12/20/2002 22:02:45 PAGE 3   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
