C51 COMPILER V9.01   LED_WORD                                                              12/18/2002 12:18:13 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LED_WORD
OBJECT MODULE PLACED IN led_word.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE led_word.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg51.h>
   2          #include <string.h> //ºóÃæ×Ö·û´®º¯ÊýÖÐÈ¡µÃÊý×éµÄ¸öÊýÖÐÓÃµ½;µ÷ÓÃstrlenº¯Êý
   3          
   4          /**************************************************************************************/
   5          
   6          //ÖØÐÂ¶¨Òå¸÷¸ö¿ØÖÆÒý½ÅµÄÃû³Æ,  sbit ÒâË¼Îª<ÖØ¶¨Òå>,,²»Òª¸ú bit ¸ã»ì,bitÊÇ»ã±àÖÐ "Î»"
   7          
   8            sbit rs = P1^0;         //ÖØ¶¨Òå,rsµçÆ½Îª1Ôò´«ËÍÊý¾Ý,Îª0Ôò×ªËÍÖ¸Áî
   9            sbit rw = P1^1;        //¿ØÖÆLCD¶Á»òÕßÐ´;Îª1Ôò¶ÁLCD,Îª0ÔòÐ´ÈëLCD
  10            sbit en = P1^2;        //LCDÐÐ¶¯¿ØÖÆ,ENÎªÏÂ½µÑØÔò½»»¥Ö´ÐÐ,¼´EN = 1;¸ú×ÅEN = 0;
  11            unsigned char code title[] = {"Multi-Function Clock"}; //title
  12            unsigned char code forward[] = {"Key 8: forward"}; //forward
  13            unsigned char code backward[]   = {"Key 7: backward"}; //backward
  14          
  15          // for control
  16          
  17            sbit forward_btn = P2^7; //key8
  18            sbit backward_btn = P2^6; //key7
  19            sbit confirm_btn = P2^5; //key6
  20            sbit reset_btn = P2^4; //key5 no need
  21            sbit t2_btn = P2^1; //key2
  22            sbit t1_btn = P2^0; //key1
  23          /**************************************************************************************/
  24          
  25          /**************************************************************************************/
  26          /*ÑÓÊ±³ÌÐò,×÷ÓÃÔÚÐèÒªÊ±½øÐÐÑÓÊ±,ÑÓÊ±Ê±³¤¿ÉÒÔÔÚµ÷ÓÃº¯ÊýÖÐ¸Ä±ä,ÈçÖ÷³ÌÐòÖÐµ÷ÓÃ:  ys (5); À¨ºÅÖÐµÄ"5"¼´Îª±¾º¯Ê
             -ýÖÐiµÄÊýÖµ;*/
  27            
  28            void ys (int i)                            //ÎÞ·µ»ØÖµ º¯ÊýÃû (¶¨ÒåÕûÐÎ±äÁ¿  Ãû³Æ i)
  29            {
  30   1           int t;                                  //¶¨ÒåÕûÐÎ±äÁ¿ Ãû³Æt
  31   1               for (; i >= 1; i --)                //Ñ­»· (¿Õº¯Êý; ÅÐ¶ÏiÊÇ·ñ´óÓÚ»òµÈÓÚ1; i¼õ1<×Ô¼õ>) iµÄÖµÊÇµ÷ÓÃ
             -´Ëº¯ÊýÊ±Éè¶¨µÄ
  32   1               {                                   //ÈôiµÄÖµ´óÓÚ»òµÈÓÚ1;Ôò½øÈëÏÂÃæÒ»¸öÑ­»·
  33   2                  for (t = 120; t > 1; t--)        //Ñ­»· (t¸³Öµ120; ÅÐ¶ÏtµÄÖµÊÇ·ñ´óÓÚ1; t×Ô¼õ)
  34   2                        {                                                //¿Õº¯Êý
  35   3                        }
  36   2               }
  37   1        }
  38          /*********************************************ÑÓÊ±³ÌÐò½áÊø*****************/
  39          
  40          /*********************************************¶ÁÃ¦×Ó³ÌÐò**************/
  41          // ¶ÁÃ¦×Ö³ÌÐò,ÓÃÓÚÅÐ¶ÏLCDÒº¾§ÊÇ·ñÃ¦×´Ì¬.Èç¹û²»½øÐÐÅÐ¶Ï¿ÉÄÜ»áµ¼ÖÂÊý¾ÝÐ´ÈëLCDÊ§°Ü.
  42          
  43             void dm ()                  //ÎÞ·µ»ØÖµ º¯ÊýÃû (¿Õ)
  44             {
  45   1           P0 = 0xff;                //°Ñ0xff·¢ËÍ¸øLCDµÄÊý¾Ý×ÜÏß
  46   1               rs = 0;               //Ñ¡Ö¸Áî
  47   1               rw = 1;               //Ñ¡Ôñ¶Á
  48   1               en = 1;               //Ê¹ÄÜ¶ËÖÃ1(¸ßµçÆ½)
  49   1               while (P0 & 0x80);    //Ñ­»· (Èç¹ûP0ºÍ0x80ÏàµÈµÄ»°) P0 & 0x80ÏàÓë,¼´P0×ÜÏßµÄ8Î»¶þ½øÖÆÊýÓë10000000
             -±È½Ï,
  50   1                                     //È«²¿ÏàÍ¬Ôò½á¹ûÎª 1<Õæ>;Ã¦×´Ì¬³ÉÁ¢,³ÌÐòÔÚ´Ë´¦ËÀÑ­»·ÏàÓë
  51   1               en = 0;               //Ê¹ÄÜ¶ËÖÃ0(µÍµçÆ½)
  52   1         }
C51 COMPILER V9.01   LED_WORD                                                              12/18/2002 12:18:13 PAGE 2   

  53          /**************************************************************************************/
  54          
  55          /***********************************************Ð´Êý¾Ý»òÖ¸Áî×Ó³ÌÐò*******************/
  56            void ddata (int x, unsigned char  DATA)//ÎÞ·µ»ØÖµ º¯ÊýÃû (¶¨ÒåÕûÐÎ±äÁ¿ x, ¶¨Òå³¤×Ö·ûÐÍ±äÁ¿ DDATA)
  57            {
  58   1            dm ();              //¶ÁÃ¦×Ó³ÌÐò
  59   1                P0 = DATA;      //Èç¹û²»Ã¦,Ôò°Ñ²ÎÊý DDATA »ñÈ¡µ½µÄ±äÁ¿¸³Öµ¸ø ×ÜÏß<P0>
  60   1                rw = 0;         //¶ÁÐ´¶ËÑ¡ÔñÎª Ð´<0>
  61   1            rs = x;             //Êý¾Ý»òÖ¸Áî¶ËÑ¡ÔñÎª²ÎÊý <x>µÄÖµ, xµÄÖµÎª0»òÕß1;Îª0±íÊ¾×ÜÏß´«ÊäµÄÊÇ¿ØÖÆLCDÖ¸Áî,Î
             -ª1±íÊ¾ÒªÏÔÊ¾µÄÊý¾Ý
  62   1                en = 1;         //Ê¹ÄÜ¶ËÖÃ1
  63   1                en = 0;         //Ê¹ÄÜ¶ËÖÃ0; ½ÓÉÏÒ»ÌõÖ¸ÁîÐÎ³ÉÒ»¸öÏÂ½µÑØ,LCDÊ¶±ðµ½ÏÂ½µÑØÐÅºÅÔò¶ÁÈ¡×ÜÏßÄÚÈÝ
  64   1        }
  65          /**************************************************************************************/
  66          
  67          /************************************************LCD³õÊ¼»¯º¯Êý******************/
  68            void lcd1602 ()            //ÎÞ·µ»ØÖµ º¯ÊýÃû (¿Õ)
  69            {
  70   1              rs = 1;             //rsÉèÖÃÎª Êý¾Ý
  71   1               rw = 1;           //rwÉèÖÃÎª ¶Á
  72   1               en = 1;           //enÉèÖÃÎª¸ßµçÆ½
  73   1               P0 = 0xff;        //×ÜÏßÐ´Èë0xff
  74   1               ys (15);          //³¤ÑÓÊ±
  75   1               ddata (0, 0x38);  //º¯ÊýÃû (Ö¸Áî, Ö¸ÁîÄÚÈÝ)  //  0·¢ËÍ¸øddataº¯ÊýÖÐµÄx,ÔÙ¾­ddataº¯Êý·¢ËÍ¸ørs,¼´rs
             -ÉèÖÃÎªÖ¸Áî;;0x38ÎªÖ¸ÁîÄÚÈÝ
  76   1               ys (5);           //¶ÌÑÓÊ±
  77   1               ddata (0, 0x38);  //0x38  ±íÊ¾ÉèÖÃ16*2ÏÔÊ¾£¬5*7µãÕó£¬8Î»Êý¾Ý½Ó¿Ú
  78   1               ddata (0, 0x08);  //0x08  ±íÊ¾Ö»¿ªÏÔÊ¾
  79   1               ddata (0, 0x01);  //0x01  ±íÊ¾ÇåÆÁ
  80   1               ddata (0, 0x06);  //0x06  ±íÊ¾µØÖ·¼Ó1£¬µ±Ð´ÈëÊý¾ÝµÄÊ±ºò¹â±êÓÒÒÆ
  81   1               ddata (0, 0x0c);  //0x0c  ±íÊ¾¿ªÏÔÊ¾£¬²»ÏÔÊ¾¹â±ê
  82   1        }
  83          /*************************************************************************************/
  84          
  85          /*************************************************ÏÔÊ¾µ¥¸ö×Ö·û*********************/
  86            void xianshi (unsigned char i, unsigned char j, unsigned char DDATA)          //ÎÞ·µ»ØÖµ º¯ÊýÃû (¶¨Òå×Ö·
             -ûÐÎ²Îi, ×Ö·ûÐÎ²Îj, ×Ö·ûÐÎ²ÎDDATA)
  87            {
  88   1           if (i)        //Èç¹û (iµÄÖµÎª1<Õæ>)
  89   1               {
  90   2        j = j + 0x40;   //µÚ¶þÐÐÆðÊ¼µØÖ·¼ÓÉÏÁÐÊýÎª×Ö·ûÏÔÊ¾µØÖ· //Ôò°Ñj¼Ó0x40ºóµÄÖµ¸³¸øj;;µÈÍ¬ÓÚj += 0x40        
             -,
  91   2        }
  92   1        j = j + 0x80;   //Í¬ÉÏ,0x80Ö¸µÚÒ»ÐÐÊ×ÁÐµÄµØÖ·,ÈôifÓï¾äÓÐÐ§, Ôò×îÖÕj=  µÚ¶þÐÐÊ××ÖÄ¸µÄµØÖ· 
  93   1               ddata (0, j);     //º¯ÊýÃû (Ö¸Áî, ÄÚÈÝ)
  94   1               ddata (1, DDATA); //º¯ÊýÃû (Êý¾Ý, ÄÚÈÝ)
  95   1        }
  96          /**************************************************************************************/
  97          
  98          
  99          /***************************************************ÏÔÊ¾×Ö·û´®************************/
 100          void xianshi1 (unsigned char y, unsigned char x, unsigned char shuzu0[])  //º¯ÊýÃû ²ÎÊý¶¨Òå
 101          {
 102   1           unsigned char j;                           //²ÎÊý¶¨Òå
 103   1               unsigned char i;                           //²ÎÊý¶¨Òå
 104   1               int k = 1;                                           //¶¨ÒåÕûÐÎ²ÎÊýk²¢¸³ÖµÎª1
 105   1               i = 0;                                                   //i¸³ÖµÎª0
 106   1               j = strlen (shuzu0)+x;                   //j = È¡Êý×é¸öÊý¼ÓÉÏx<Ê×ÁÐÎ»ÖÃ>µÄÖµ,×îÖÕjµÄÖµÎªÊý×éÖÐ×îº
             -óÒ»Î»×Ö·ûµÄÁÐ,j×îÖÕÖµÔÚ0~15Ö®¼ä
 107   1      
 108   1               for (; k > 0;)                                   //Ñ­»· (¿Õ; Èç¹ûk´óÓÚ0;¿Õ)                      
             -                                                  !
C51 COMPILER V9.01   LED_WORD                                                              12/18/2002 12:18:13 PAGE 3   

 109   1               {                                                           //Ôò                                 
             -                                                                                       !
 110   2                                                                          //ÅÐ¶Ï                                
             -                                                                                ! ËùÓÐ¼Ó "!" ±¸×¢µÄ´úÂë¿ÉÒÔÑ¹ËõÎª:
 111   2               if (x < j)                                           //Èç¹û (µ±Ç°ÏÔÊ¾ÁÐÊýx < ×îºóÒ»Î»×Ö·ûµÄÁÐÊýj)
             -                                        ! while (x < j)
 112   2               {                                                           //Ôò                                 
             -                                                                                       ! {
 113   3                 xianshi (y, x, shuzu0[i]);  //º¯ÊýÃû (ÐÐy<0»ò1>ËÍ³ö, ÁÐx<0~15>ËÍ³ö, Êý×é[µÚiÎ»]ËÍ³ö)           
             -     !         xianshi (y, x, shuzu0[i]);
 114   3                 x ++;                                           //ÁÐÊý¼Ó1                                      
             -                                                                  !         x++;
 115   3                 i ++;                                           //Êý×éµÚiÎ»¼Ó1                                 
             -                                                               !         i++;
 116   3               }                                                                                //              
             -                                                                                          !  }
 117   2               else                                                    //·ñÔò                                   
             -                                                                             !
 118   2               {                                                                                //              
             -                                                                                          !
 119   3                 k = 0;                                           //k ÖÃ0,  forÑ­»·ÍË³ö                         
             -                                                       !
 120   3               }
 121   2               }
 122   1      }
 123          /****************************************************Ö÷º¯Êý***********************/
 124          
 125          /**************************************************************************************/
 126            void main ()                         //Ö÷º¯Êý
 127            {
 128   1      
 129   1           ys (15);                           //³¤ÑÓÊ±
 130   1               lcd1602 ();                    //³õÊ¼»¯LCD
 131   1                      
 132   1               //xianshi1(0, 0, title);        //ÏÔÊ¾×Ö·û´®
 133   1      
 134   1                       P3 = 0x11;
 135   1      
 136   1                      
 137   1               xianshi1(0, 0, forward);        //ÏÔÊ¾×Ö·û´®
 138   1      
 139   1                      
 140   1               xianshi1(1, 0, backward);        //ÏÔÊ¾×Ö·û´®
 141   1               while (1){
 142   2                       lcd1602 ();
 143   2                              if(forward_btn == 1){
 144   3                                              lcd1602 ();
 145   3                                              xianshi1(0,0,title);
 146   3                              }else{
 147   3                                         lcd1602 ();
 148   3                                              xianshi1(0,0,forward);
 149   3                              }
 150   2                       }
 151   1        }
 152          /**************************************************************************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    296    ----
   CONSTANT SIZE    =     52    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.01   LED_WORD                                                              12/18/2002 12:18:13 PAGE 4   

   DATA SIZE        =   ----       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
